class ArcheApi

  def initialize
    params
  end

  def call_operation(operation, params={})
    message_params = @params
    message_params[:arg0] = message_params[:arg0].merge(params)
    message_params = params_new
    request(operation, message_params)
  end

  def request(operation, message_params)
    client.call(operation.to_sym, message: message_params, multipart: true)
  rescue Savon::Error => e
    puts "Error Savon: #{e.inspect} - #{operation} - #{message_params}"
    return {operation: operation, error: true, message: e.inspect, params: message_params }
  end

  def client
    Rails.logger.info {"  INFO - archeApi#wsdl: :  #{    wsdl = Rails.application.secrets.arche_api['wsdl']}" }
    @client ||= Savon.client(wsdl:  Rails.application.secrets.arche_api['wsdl'])
  end

  private

  def params
    @params ||= {
      arg0: {
        aplicacion:   Rails.application.secrets.arche_api['aplication'],
        localizacion: Rails.application.secrets.arche_api['location'],
        login:        Rails.application.secrets.arche_api['login'],
        password:     Rails.application.secrets.arche_api['password'],
      }
    }
  end

  def params_new
   {
    arg0:{
      aplicacion:   Rails.application.secrets.arche_api['aplication'],
      localizacion: Rails.application.secrets.arche_api['location'],
      login:        Rails.application.secrets.arche_api['login'],
      password:     Rails.application.secrets.arche_api['password'],
      :expediente=>{:atributos=>{:clave=>"cod_expediente", :valores=>"0501_2018_10000001"},
                    :atributos=>{:clave=>"fecha_apertura", :valores=>'21/12/2017'},
                    :operacion=>0, :tipo=>"ayto_f_archivo", :nombre=>"Titulo del expediente"},
      :documentos=>{:atributos=>{:clave=>"fecha_documento", :valores=>'21/12/2017'},
                :atributos=>{:clave=>"title", :valores=>"title del doc"},
                :operacion=>0, :nombre=>"Nombre del documento", :tipo=>"ayto_d_archivo",
                :fichero=>'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EREBERAREQEREEVJRUkBRUkQEXmXMvxnLdjvMcvNQeqIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIocWXg8HCgmijkpICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiIC8wbx7RF6S9EQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBZmQX9+zfmj+ytMszI92jfo/soNIPKiDyogkiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICLyN5ttwRIuIuVTFBJERAREQEREBERARFFB+7Nvh+0v1RERHlUkBERAREQEREBERAREQEREBF5kJZc3CpCgkiKOSCSKAkJDkKmgIiICIiAiIgjipIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIijlxYoJIiII5KS8XN5vBxxx7S9kBERAREQEREBERAREQEUVJAREQEREBERAREQEREBERAREQEREBERAREQFEsuypIgiOWPF9tSREBERAREQEREBERAXlscycIfs8K9UQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAWae92bfoj9FaVZiSP9+bfoj9FBp0UR5UQSREQEREBERARF4vPCyBOFyiOSD2ReTTgOsi43xCXEK9UBERAREQFEsuypIgIiICIiAiIgIiICIiAiIgIiICIiAiIg8jYbccFwh8JN8q9Nn2l+ogIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICiSkiCADgGwVNEQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREEVJEQEREBERAREQEREBERBFSREBERAREQEREBERAREQEREBERAREQEREBERBEixQSyHJSRAREQeAvETzje1otgj2u8vUUxHLJSQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQFmZHuyH0RWmWdfx8rx9EUGgHlRSRAREQEREBERAXFYuAzAkOuDkIt8QrtXLMiDLb3ZOOCPmoPKo2tbamPuQJtvd8IlzCu9UtlvYz9e42RCIv7sh72SuBQSREQEREBERAREQEREBERARRUkBERARR7SCWSCSjlxYqSICIiAiIgIiICIiAiIgIiICIiAiIgIiII7f8AQoDvPsZCIr1RAREQEREESQeVSRAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQERRyQSREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBEUduXh+wgkiIgIiICIiAigXLt4sVBgXG2RFxzeFs5iQeyIiAiIgIiICIiAiKJFiORIJIojxCpICIiAiIgIiICIiAiIgLNv+7IfRFaLtLPvZeVY5d0UGiREQEREBERAREQERebhCIlkg5LFsXWm/s+At4JCu0Vx5daJkhxJseIiXYKCSIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiIIkPaQVJEBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERARQccBscjLHYpoCjjxKSICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICKKkgIiICIiAiIgIiICIiAiIgKJFipKOOSCSIiAiIgIiICIiAiIgj2lJEQEREBZ2T7r2/RFaJUL/urb/JigvkREBERAREQEREBcz8RmTt9mHLzcl0qO3/Qggy2DTe7bEREeyK9VEVJAREQEReTjm7DIsvgoPVFEVJAREQEREBERAREQEREBERAREQEREBERB5bWx3m87WKmKkiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgjlipKJDkpICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIoiWSCSIiAiIgIiICIiAiIgIiICIiDkkkJE22TJObCL4q6R5UQUEkREBERAREQEREBERARFFBJERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAWek+61v8AJir0ixIRVHKH++lsh7ooNAiIgIiICIiAiIgIiICIiAiKJIJIoiOKkgIiICIiAiIgIiICIiCOPFkpIiAiIgIigW3HiLb9hBNFBshcHISyElNAREQEREBERAXk6QNgRkWIjxEvVeZCg8K+dGsYbcuK6LjLnKQ9pda8WGhZa2NgIiOzujivZAREQEREBeEp8I0dx5zLFscixXuo7eZB4QpTU2E3JZ9rcHIcl0qA+AR+wOOxTQEREBERAREQEREBERAREQEREBERAREQEREBERAUclJEBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREENpD4ccvsqahux2lltH7KmgIiICIiAiIgIiICIiAiIgIiICIiAiIgKKkiDzEcVSu7f75hH0VeEqFwf76x9EUGgREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREES83mX43lhsz5lNEBERAREQEREBERAREQERebhYjy5IPRFEVJAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREHkZGJiIt5CXMWXKpipIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICiSkiCKkiiRYoJIoipICIiAiIgiSo3vs6ob9EVfKhd90w/BQXyIiAiIgIiICIiCO0vBtXBT2jVtCKS2O0RFwm/iqds4TcB4myxIRUKWM1HrGRZHES4kFiiIgIooIiPKgkiIgIiII5DlipKKkgIiICIiAiIgIuCws4FYAuWE6PDbLhEn3hbEvjLiLVumfxiqvnrfrILxF4sONvsi604LjZ8QkP2iXsgIvMixJckO0r5rhNxZbLzg8wtlkg70URUkBERAREQEREBERAREQERVF/qKDpuKzKn7zduvCyO7HLiJBboqmhvoWoq7r8LLdbwm/ZBx25Cq7Wer4+kYDL7rBSnpDm7ZZAsSJBp0VVRz5ljVNy50Aq91zZl1cnd4Q7P/RWeSCSKOSkgIir7C2ratsXLCbHiiXKTzgjkgsEVFH1fp6XI3DNzFJzsjvR4ldCQ7RyH7SCaKOQpkKCSIo5IJIo5JkgkijkKZIJKKZCmSApKsu7mJRVb1jOIhjsY57RHLmLH/8AaoUF7B1FXbZ1ftLazvCa4hxLIUFsiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICLyJvYRZYr1QEREBERAREQEREBERAREQEUUFBJERAREQEREBERAREQEREBVN9avU1ac1uEUsW+JwALEhH+dWy4bNpp6tlNOli2TJCWPdxQcFJq2rvqgrOK5iy37YLnCQrw07rKq1KMjqpE24wRZNv8JbR73or5LTxt5CitQ8nGxIhb/ehD1sR73EvZuufKFjHy3hSd5vm4hc33vLLlQfVKvW9Tb3kipjG5vmP5Qh4XPRXn5c1has8QDkRY/ZkZex7HO6vlrjJfvgmxEXi9sEYxCTPo8SkMB0Zot9WbF4W8ib6oXynMg+nXmtmKy1j08OG5YWUksRZbcERH0i/iWkZMjZEnB2A54OIRLLFfItKxWduuKw5OwtjgC4Uchj4k+WPERERL7CHKg/VVWNyFfa1sAmsts9wmxLw8uI5K1WT1Jt2+Wmltn8W+f/AKtbI1eSko9lBWARYpkqDWWoh0xpyRZbBze9rZb29pwuVY9ydqyFphvUzl6w49iMhys3Qi3u+7lzcqD6fkmSz8XVESTo/ZqbAtjHVyeIe7jzD+qszpx/VWtIBXHjcqiK4RdXaYbEsvSyQfRskyWTC2s9N6Qm2OozbeeiEWO1v+UHhEf1tqqqVrVuqIDdrIt/FDbnEzHZbHl7xIPoOSjvOJYjSmqbJzUE7TGoMOvxuJl1vZ7cCq27e+k9LNpQR55dV3YmIl/IjiOWPxkH00S8KZcWK+dUOobas6RHtJWkspzbje8ZeLm5claaz1bJqJsGmqWhetJ5cOXK2PeQbHJMlhp1Nq6uieMIuonJcpscnIzg+xl6KsNL6oa1VpUp7fsMhsSbeEf5NzFBqckXyvQcrU2qtFSCK4facakljJyycIsRLH0eJe+lr2+1vWdUbl+LjgYjIkiOROOdnHzUH03JZ3VOpXqLbCjwYBT5017dsseHHh7RZKq6PNS2Fzttay2IXJVXI3JOCPMPF6qrHrewLpxj1fW3Op7gvYcuH2vJB9HbMibEjHEseIVNZSxrdS2V88I23i6pbESb6sPsjhdrJVWitS2LuqrPTNlJGdthBvGZYj9kxyHLL4woPoSig8qwnSVKuaZmDe1014YsV4etsDykPeQbvJfuz7S+d671ZKKrqYWn3XBn3hCTJtlxNjw+stzAZdjwWWHnykOAOJOlzF5yDsVbd2W2npZ1hsa3m2JHN7HLHLEfCrJUGt9uOh7ov9ic+igs66bsnVsaXjhv2hcx7uQ5LsVZp/3PVv5o39EVZoIpkqnU9i9V6asrCNjvo0cnG95y5eBfM6npPuI'
     }
   }
  }
  end
end
